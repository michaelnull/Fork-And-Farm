
@{
    ViewBag.Title = "AdList";
}

<h2>AdList</h2>

<section ng-controller="DisplayController as display" ng-init="display.page = 1">
    <button ng-click='display.create()'>Create New</button>
    <div class="row">
    <div class="col-lg-6">
        <div class="input-group">
            <span class="input-group-btn">
                <button class="btn btn-default" ng-click='display.search("/Advertisements/AllAds/", searchdata)' type="button">Search Products!</button>
            </span>
            <input type="text" class="form-control" ng-model="searchdata" placeholder="Search for Products...">
        </div><!-- /input-group -->
    </div><!-- /.col-lg-6 -->
        <div class="col-lg-6">
            <div class="input-group">
                <input type="text" class="form-control" ng-model="orgsearch" placeholder="Search Suplliers and Purchasers">
                <span class="input-group-btn">
                    <button class="btn btn-default" ng-click='display.search("/Advertisements/SearchOrg/" , orgsearch)' type="button">Search Organizations!</button>
                </span>
            </div><!-- /input-group -->
        </div><!-- /.col-lg-6 -->
    </div><!-- /.row -->
    <div class="container green">
        
        <div class="container mylist" ng-repeat="ad in display.show" >
            <div class="row">
                <div class="col-xs-6 col-sm-2 col-md-1">
                    {{ad.AdType}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    Posted on:<br />  {{ad.CreatedOn | date: "mediumDate"}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    {{ad.Product}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    {{ad.Quantity}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    {{ad.Unit}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    per unit: <br />  {{ad.UnitPrice | currency}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    total: <br />  {{ad.ExtPrice | currency}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    for delivery on: <br />  {{ad.Delivery | date: "mediumDate"}}
                </div>
                <div class="col-xs-6 col-sm-2 col-md-1">
                    {{ad.ProposedByOrganization}}
                </div>
                <div>
                    <button ng-show="display.userinfo.UserName == ad.ProposedBy" class="btn btn-danger" ng-click="display.deletead(ad.Id)">Delete</button>
                </div>
            </div>
            
            <div class="row">
                Memo:  {{ad.Memo}}

            </div>
            <div class="row">

                <button ng-click="showDetails = !showDetails; display.responses = {}; display.offermessage = 'awaiting data'">Details</button>
                <div ng-show="showDetails">
                    Proposed by user: {{ad.ProposedBy}} 
                    Contact Phone Number: {{ad.ProposedByPhone}}
                    Reference number: {{ad.Invoice}}
                   
                    <!--Hide section if transaction not allowed-->
                    <div ng-show="(ad.AdType=='Purchase Ad' && display.userinfo.UserRole =='Supplier') || (ad.AdType=='Supply Ad' && display.userinfo.UserRole=='Purchaser')">
                        <h4 ng-hide="display.offermessage=='awaiting data'">{{display.offermessage}}</h4> 
                        <button ng-click="showOffer = !showOffer">Make an Offer</button>
                        <div ng-show="showOffer">
                            <h3>Make an Offer</h3>
                            <form id="offerform" name="offerform" class="form-horizontal" ng-submit='display.submitoffer(ad.Id, deal); offerform.$setPristine()' >
                               
                                 <div class="form-group">
                                    <label class="control-label col-md-2">Quantity</label>
                                    <div class="col-md-10">
                                        <input class="form-control text-box single-line" type="text" ng-model="deal.Quantity" ng-init="deal.Quantity = ad.Quantity" />
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Quantity" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-2">Unit Price</label>
                                    <div class="col-md-10">
                                        <input class="form-control text-box single-line" type="text" ng-model="deal.UnitPrice" ng-init="deal.UnitPrice = ad.UnitPrice" />
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Unit Price" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label col-md-2">Delivery Date</label>
                                    <div class="col-md-10">
                                        <input class="form-control text-box single-line" type="date" ng-model="deal.Delivery" ng-init="deal.Delivery = ad.Delivery" />
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Delivery Date" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-2">Payment Terms</label>
                                    <div class="col-md-10">
                                        <input class="form-control text-box single-line" type="text" ng-model="deal.PaymentTerms" ng-init="deal.PaymentTerms = ad.PaymentTerms" />
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Payment Terms" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-2">Memo</label>
                                    <div class="col-md-10">
                                        <input class="form-control text-box single-line" type="text" ng-model="deal.Memo" placeholder="Enter Memo notes here..."/>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Memo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="col-md-offset-2 col-md-1">
                                    <input class="btn btn-primary" ng-disabled="offerform.$pristine" type="submit" value="Submit"  />
                                </div>
                                <div class="col-md-1">
                                    <input type="reset" class="btn btn-danger" value="Reset" ng-click="display.offermessage='awaiting data'; offerform.$setPristine()" />
                                </div>
                            </form>
                        </div>
                    </div><!--end of make offer collapsable section-->
                    <div>
                        <button ng-click="display.getresponses(ad.Id)">Show responses on this Ad</button>
                        <div> <!--list of offers section-->
                           
                            <div class="container mylist" ng-repeat="response in display.responses">
                                <div class="container row">
                                    <div>
                                        Proposed by: {{response.ProposedByOrganization}}
                                        Quantity: {{response.Quantity}}
                                        Unit Price: {{response.UnitPrice | currency}}
                                        Extended Price: {{response.ExtPrice | currency}}
                                        Delivery Date: {{response.Delivery | date:"mediumDate"}}
                                    </div>
                                    <div class="container row">
                                        Memo: {{response.Memo}}
                                    </div>
                                    <div ng-show="response.ProposedBy == display.userinfo.UserName">
                                        <button class="btn btn-danger" ng-click="display.deleteresponse(response.Id)">Delete</button>
                                    </div>
                                </div>
                            </div>
                        <div ng-show="display.allresponses.length > display.responses.length">
                            <button ng-click="display.showtenmoreresponses()">Show 10 more responses</button>
                        </div>
                    </div><!--end of list of offers section-->
                </div>
            </div> <!--end of details collapsable section-->
        </div>
    </div>
        </div>

    <div class="pagebar btn-group" role="group" aria-label="...">
        <button ng-hide="display.page <= 2" type="button" class="btn btn-default"><div ng-click='display.goto(1)'>go to page 1</div></button>
        <button ng-hide="display.page === 1" type="button" class="btn btn-default"><div ng-click='display.goto(display.page - 1)'>go to page {{display.page - 1}}</div></button>
        <button type="button" class="btn btn-default">this is page {{display.page}}</button>
        <button type="button" class="btn btn-default"><div ng-click='display.goto(display.page + 1)'>go to page {{display.page + 1}}</div></button>

    </div>
</section>

    @section scripts{
        <script type="text/javascript" src="~/Scripts/angular.min.js"></script>
        <script type="text/javascript" src="~/Content/app.js"></script>
        <link rel="stylesheet" type="text/css" href="~/Content/dataTables.bootstrap.min.css" />
        <script>function resetform(id) {
   
    document.getElementById(id).reset();
    window.alert("clear function called for " + id);
        }
        </script>
       
        
    }
